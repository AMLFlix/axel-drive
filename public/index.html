<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axel Drive</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --surface-color: #242424;
            --header-surface-color: #242424;
            --sidebar-surface-color: #242424;
            --dialog-surface-color: #2c2c2c;
            --hover-bg-color: #ffffff1a;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
            --border-color: #3a3a3a;
            --active-item-bg: #c2e7ff;
            --active-item-text: #001d35;
            --font-family: 'Roboto', sans-serif;
            --border-radius: 12px;
            --item-border-radius: 8px;
            --btn-primary-bg: #4285F4;
            --btn-success-bg: #34A853;
            --btn-danger-bg: #EA4335;
            --btn-warning-bg: #FBBC04;
            --btn-secondary-bg: #5f6368;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        #progressBar { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background-color: transparent; z-index: 9999; overflow: hidden; display: none; }
        #progressBar::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--btn-primary-bg); animation: indeterminate-progress 1.5s infinite ease-in-out; }
        @keyframes indeterminate-progress { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

        .main-container { display: none; flex-grow: 1; overflow: hidden; }
        .main-container.active { display: flex; }
        
        .app-header { background-color: var(--header-surface-color); padding: 8px 20px; display: flex; align-items: center; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        .header-logo { display: flex; align-items: center; gap: 8px; font-size: 22px; font-weight: 500; margin-right: 20px; }
        .header-logo i { color: var(--btn-primary-bg); }
        .search-bar { flex-grow: 1; display: flex; align-items: center; background-color: #313335; padding: 0 8px; border-radius: 24px; max-width: 720px; }
        .search-bar .material-icons { color: var(--text-secondary); padding: 8px; }
        .search-bar input { flex-grow: 1; background: transparent; border: none; outline: none; color: var(--text-primary); padding: 12px 8px; font-size: 16px; }
        .header-actions { display: flex; align-items: center; margin-left: auto; gap: 8px; }
        .icon-btn { background: none; border: none; color: var(--text-secondary); padding: 8px; border-radius: 50%; cursor: pointer; transition: background-color 0.2s, color 0.2s; display: flex; align-items: center; justify-content: center; }
        .icon-btn.active, .icon-btn:hover { background-color: var(--hover-bg-color); color: var(--text-primary); }
        .profile-btn { width: 32px; height: 32px; background-color: #673AB7; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; color: white; cursor: pointer; }
        .profile-menu { position: relative; }
        .dropdown-menu { display: none; position: absolute; right: 0; top: 45px; background-color: var(--dialog-surface-color); border-radius: var(--item-border-radius); box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 100; width: 250px; padding: 8px 0; }
        .dropdown-menu.show { display: block; }
        #logoutBtn { display: flex; align-items: center; gap: 12px; padding: 12px 16px; width: 100%; text-align: left; border: none; background: none; color: var(--text-primary); cursor: pointer; }
        #logoutBtn:hover { background-color: var(--hover-bg-color); }
        
        .sidebar { width: 256px; background-color: var(--sidebar-surface-color); padding: 16px 12px; display: flex; flex-direction: column; flex-shrink: 0; border-right: 1px solid var(--border-color); }
        .sidebar-nav { flex-grow: 1; margin-top: 16px; }
        .sidebar-nav ul { list-style: none; padding: 0; margin: 0; }
        .sidebar-nav li a { display: flex; align-items: center; gap: 16px; padding: 10px 16px; border-radius: var(--border-radius); text-decoration: none; color: var(--text-primary); font-size: 14px; transition: background-color 0.2s, color 0.2s; }
        .sidebar-nav li a:hover { background-color: var(--hover-bg-color); }
        .sidebar-nav li a.active { background-color: var(--active-item-bg); color: var(--active-item-text); font-weight: 500; }

        .sidebar-footer { margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border-color); }
        .sidebar-footer p { font-size: 12px; color: var(--text-secondary); text-align: center; margin: 0 0 12px 0; }
        .social-links { display: flex; justify-content: center; gap: 20px; }
        .social-links a { font-size: 22px; transition: transform 0.2s; }
        .social-links a:hover { transform: scale(1.1); }
        .social-links a.facebook { color: #1877F2; }
        .social-links a.telegram { color: #26A5E4; }

        .content-area { flex-grow: 1; padding: 24px; display: flex; flex-direction: column; overflow-y: auto; }
        .content-header { padding-bottom: 20px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); gap: 16px; }
        .content-header h1 { font-size: 24px; margin: 0; flex-grow: 1; }
        .account-search-bar { display: flex; align-items: center; background-color: #313335; padding: 0 8px; border-radius: 20px; }
        .account-search-bar input { background: transparent; border: none; outline: none; color: var(--text-primary); padding: 8px; font-size: 14px; }
        .pagination-controls { display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 24px; padding-bottom: 20px; }
        .pagination-controls button { background-color: var(--surface-color); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 12px; border-radius: 6px; cursor: pointer; transition: background-color 0.2s; }
        .pagination-controls button:disabled { cursor: not-allowed; opacity: 0.5; }
        .pagination-controls button:not(:disabled):hover { background-color: var(--hover-bg-color); }
        .pagination-controls button.active { background-color: var(--btn-primary-bg); border-color: var(--btn-primary-bg); }

        #app { flex-grow: 1; padding-top: 16px; }

        .login-wrapper { display: none; align-items: center; justify-content: center; width: 100%; height: 100vh; }
        .login-wrapper.active { display: flex; }

        .card { background-color: var(--dialog-surface-color); border-radius: var(--border-radius); padding: 32px; border: 1px solid var(--border-color); box-shadow: 0 8px 24px rgba(0,0,0,0.3); width: 100%; }
        .login-wrapper .card { max-width: 400px; }
        .card h2 { text-align: center; margin-top: 0; margin-bottom: 24px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-secondary); font-weight: 500; }
        .form-group input { width: 100%; padding: 12px; background-color: #313335; border: 1px solid var(--border-color); border-radius: var(--item-border-radius); color: var(--text-primary); font-size: 16px; box-sizing: border-box; transition: border-color 0.2s; }
        .form-group input:focus { outline: none; border-color: var(--btn-primary-bg); }
        
        .form-actions { margin-top: 32px; display: flex; justify-content: flex-end; gap: 12px; }
        .btn { padding: 12px 24px; font-size: 14px; font-weight: 500; border-radius: var(--item-border-radius); cursor: pointer; border: none; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); display: inline-flex; align-items: center; gap: 8px; justify-content: center; }
        .btn:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.3); transform: translateY(-1px); }
        .btn:active { transform: translateY(0); }
        .btn-primary { background-color: var(--btn-primary-bg); color: white; }
        .btn-success { background-color: var(--btn-success-bg); color: white; }
        .btn-danger { background-color: var(--btn-danger-bg); color: white; }
        .btn-warning { background-color: var(--btn-warning-bg); color: #202124; }
        .btn-secondary { background-color: var(--btn-secondary-bg); color: white; }
        
        .icon-folder { color: #0A84FF !important; } .icon-movie { color: #FF453A !important; } .icon-music_note { color: #FF2D55 !important; } .icon-image { color: #30D158 !important; } .icon-picture_as_pdf { color: #BF5AF2 !important; } .icon-archive { color: #FF9F0A !important; } .icon-article { color: #6C6C70 !important; } .icon-account_circle { color: #FFD60A !important; }

        /* Other UI styles ... */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; padding-top: 16px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 2000; backdrop-filter: blur(5px); }
        .modal-overlay.show { display: flex; }
        .modal-content { background-color: var(--dialog-surface-color); padding: 24px; border-radius: var(--border-radius); max-width: 500px; width: 100%; }
        .modal-content.video-modal { max-width: 90vw; max-height: 90vh; }
        .modal-actions { margin-top: 24px; display: flex; justify-content: flex-end; gap: 10px; }
        video.media-player { width: 100%; border-radius: var(--item-border-radius); }
        .account-card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding-top: 20px; }
        .account-card { background-color: var(--surface-color); border-radius: var(--border-radius); padding: 20px; display: flex; flex-direction: column; gap: 15px; border: 1px solid var(--border-color); transition: transform 0.2s ease, box-shadow 0.2s ease; cursor: pointer; position: relative; }
        .account-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); }
        #backButton { display: flex; align-items: center; gap: 8px; background: none; border: none; color: var(--text-primary); font-size: 16px; cursor: pointer; padding: 0; margin-bottom: 0; transition: color 0.2s; }
        #backButton:hover { color: var(--btn-primary-bg); }
    </style>
</head>
<body>
    <div id="progressBar"></div>

    <div class="login-wrapper active" id="loginContainer">
        <div class="card">
            <h2>Admin Login</h2>
            <div class="form-group"><label for="username">Username</label><input type="text" id="username" value="admin"></div>
            <div class="form-group"><label for="password">Password</label><input type="password" id="password"></div>
            <button id="loginBtn" class="btn btn-primary" style="width: 100%;">Login</button>
        </div>
    </div>

    <header class="app-header" style="display: none;">
        <div class="header-logo"><i class="fa-brands fa-google-drive"></i><span>Axel Drive</span></div>
        <div class="search-bar"><span class="material-icons">search</span><input type="search" id="searchDriveInput" placeholder="Search in Drive"></div>
        <div class="header-actions">
            <div class="profile-menu">
                <button class="profile-btn" id="profileBtn">A</button>
                <div class="dropdown-menu" id="profileDropdown">
                    <button id="logoutBtn"><span class="material-icons">logout</span><span>Logout</span></button>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container" id="mainContainer">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" id="myDriveLink" class="active"><span class="material-icons">folder</span> My Drive</a></li>
                    <li><a href="#" id="accountsLink"><span class="material-icons">account_box</span> Accounts</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <p>Powered By Aung Myo Linn</p>
                <div class="social-links">
                    <a href="#" target="_blank" title="Facebook" class="facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" target="_blank" title="Telegram" class="telegram"><i class="fab fa-telegram"></i></a>
                </div>
            </div>
        </aside>
        <main class="content-area"><div id="app"></div></main>
    </div>

    <script>
        const WORKER_BASE_URL = "https://axel-drive.comtv.workers.dev";
        const $ = (selector) => document.querySelector(selector);
        
        let adminToken = localStorage.getItem('admin_token');
        let currentAccountId = null;
        let currentFiles = [];
        let allAccounts = [];
        let viewMode = 'grid';
        let currentFolderStack = [{ id: 'root', name: 'My Drive' }];

        const CONSTS = { folder_mime_type: "application/vnd.google-apps.folder" };

        function showLoading() { $('#progressBar').style.display = 'block'; }
        function hideLoading() { $('#progressBar').style.display = 'none'; }
        
        async function apiRequest(endpoint, method = 'GET', body = null) {
            showLoading();
            const headers = { 'Content-Type': 'application/json' };
            if (adminToken) {
                headers['Authorization'] = `Bearer ${adminToken}`;
            }
            try {
                const res = await fetch(`${WORKER_BASE_URL}${endpoint}`, { method, headers, body: body ? JSON.stringify(body) : null });
                if (res.status === 401) {
                    handleLogout(true); // silent logout
                    throw new Error('Auth required');
                }
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'API request failed');
                return data;
            } catch (err) {
                console.error('API Error:', err);
                if (!err.message.includes('Auth')) showMessage(err.message);
                throw err;
            } finally {
                hideLoading();
            }
        }
        
        function handleLogout(silent = false) {
            localStorage.removeItem('admin_token');
            adminToken = null;
            if (!silent) showMessage('You have been logged out.');
            showLoginPage();
        }

        function showApp() {
            $('#loginContainer').classList.remove('active');
            $('.app-header').style.display = 'flex';
            $('#mainContainer').classList.add('active');
        }

        function showLoginPage() {
            $('#loginContainer').classList.add('active');
            $('.app-header').style.display = 'none';
            $('#mainContainer').classList.remove('active');
        }

        function renderAccounts(currentPage = 1) {
            const listDiv = $('#accountsList');
            const paginationDiv = $('#accountsPagination');
            const searchTerm = $('#accountSearchInput').value.toLowerCase();
            const filteredAccounts = allAccounts.filter(acc => acc.name.toLowerCase().includes(searchTerm) || acc.id.toLowerCase().includes(searchTerm));

            if (!filteredAccounts.length) {
                listDiv.innerHTML = '<p style="text-align:center; padding: 40px; color: var(--text-secondary);">No accounts found.</p>';
                paginationDiv.innerHTML = ''; return;
            }
            
            const itemsPerPage = 6;
            const totalPages = Math.ceil(filteredAccounts.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const paginatedAccounts = filteredAccounts.slice(startIndex, startIndex + itemsPerPage);
            
            listDiv.innerHTML = paginatedAccounts.map(acc => `...`).join(''); // Implementation hidden for brevity
            paginationDiv.innerHTML = `...`; // Implementation hidden for brevity

            // Attach listeners
        }

        async function showGoogleAccountsPage() {
            setActiveNav('accountsLink');
            currentAccountId = null;
            const appDiv = $('#app');
            appDiv.innerHTML = `
                <div class="content-header">
                    <h1>Google Drive Accounts</h1>
                    <div class="account-search-bar"><span class="material-icons">search</span><input type="search" id="accountSearchInput" placeholder="Search accounts..."></div>
                    <button id="addAccountBtn" class="btn btn-success"><span class="material-icons">add</span> Add New</button>
                </div>
                <div id="accountsList" class="account-card-container"></div>
                <div id="accountsPagination" class="pagination-controls"></div>`;
            
            $('#addAccountBtn').onclick = () => showAddEditAccountPage();
            $('#accountSearchInput').onkeyup = () => renderAccounts(1);
            
            try {
                allAccounts = await apiRequest('/api/settings/list');
                renderAccounts();
            } catch (e) { /* handled in apiRequest */ }
        }

        async function showAddEditAccountPage(accountId = null) {
            const appDiv = $('#app');
            const account = accountId ? await apiRequest(`/api/settings/get/${accountId}`) : {};
            appDiv.innerHTML = `
                <div class="content-header">
                    <button id="backButton"><span class="material-icons">arrow_back</span> Back to Accounts</button>
                    <h1>${accountId ? 'Edit' : 'Add'} Account</h1>
                </div>
                <div class="card" style="margin-top:24px; max-width:700px; margin-left:0;">
                    <div class="form-group"><label>Account ID</label><input type="text" id="accountId" value="${account.id || ''}" ${accountId ? 'readonly' : ''}></div>
                    <div class="form-group"><label>Account Name</label><input type="text" id="accountName" value="${account.name || ''}"></div>
                    <div class="form-group"><label>Client ID</label><input type="text" id="clientId" value="${account.client_id || ''}"></div>
                    <div class="form-group"><label>Client Secret</label><input type="text" id="clientSecret" value="${account.client_secret || ''}"></div>
                    <div class="form-group"><label>Refresh Token</label><input type="text" id="refreshToken" value="${account.refresh_token || ''}"></div>
                    <div class="form-actions">
                        <button id="cancelBtn" class="btn btn-secondary">Cancel</button>
                        <button id="saveAccountBtn" class="btn btn-primary">Save</button>
                    </div>
                </div>`;

            $('#backButton').onclick = showGoogleAccountsPage;
            $('#cancelBtn').onclick = showGoogleAccountsPage;
            $('#saveAccountBtn').onclick = async () => { /* ... save logic ... */ };
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (adminToken) {
                showApp();
                showGoogleAccountsPage();
            } else {
                showLoginPage();
            }

            $('#loginBtn').onclick = async () => {
                const u = $('#username').value, p = $('#password').value;
                try {
                    const data = await apiRequest('/api/auth/login', 'POST', { username: u, password: p });
                    adminToken = data.token;
                    localStorage.setItem('admin_token', adminToken);
                    showApp();
                    showGoogleAccountsPage();
                } catch (error) { /* handled */ }
            };

            $('#profileBtn').onclick = () => $('#profileDropdown').classList.toggle('show');
            document.addEventListener('click', (e) => {
                if (!$('.profile-menu').contains(e.target)) {
                    $('#profileDropdown').classList.remove('show');
                }
            });

            $('#logoutBtn').onclick = () => {
                showConfirmModal('Are you sure you want to logout?', () => handleLogout(false));
            };

            $('#accountsLink').onclick = (e) => { e.preventDefault(); showGoogleAccountsPage(); };
            $('#myDriveLink').onclick = (e) => { e.preventDefault(); /* ... */ };
        });

    </script>
</body>
</html>